<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="cyber-card p-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2 class="mb-2">Welcome back, <span class="glow-text">{{ user.username }}</span>! ðŸ‘‹</h2>
                        <p class="text-secondary mb-0">Your private AI assistant is ready. All data encrypted and local.</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <a href="{% url 'chat' %}" class="btn btn-cyber btn-lg">
                            <i class="bi bi-chat-dots-fill"></i> New Chat
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="cyber-card p-4 text-center h-100">
                <div class="h2 mb-2 glow-text">{{ total_messages }}</div>
                <div class="text-secondary">Total Messages</div>
                <div class="mt-2">
                    <small class="text-success">
                        <i class="bi bi-shield-check"></i> {{ encrypted_messages }} Encrypted
                    </small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="cyber-card p-4 text-center h-100">
                <div class="h2 mb-2 glow-text">{{ conversations.count }}</div>
                <div class="text-secondary">Active Chats</div>
                <div class="mt-2">
                    <small class="privacy-badge">
                        <i class="bi bi-lock-fill"></i> Private
                    </small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="cyber-card p-4 text-center h-100">
                <div class="h2 mb-2 glow-text">{{ documents.count }}</div>
                <div class="text-secondary">Documents</div>
                <div class="mt-2">
                    <small class="text-info">
                        <i class="bi bi-file-earmark-text"></i> Encrypted
                    </small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="cyber-card p-4 text-center h-100">
                <div class="mb-2">
                    {% if llm_status == 'Online' %}
                        <span class="badge bg-success" style="font-size: 1.2rem;">ðŸŸ¢ Online</span>
                    {% else %}
                        <span class="badge bg-warning" style="font-size: 1.2rem;">ðŸŸ¡ Mock</span>
                    {% endif %}
                </div>
                <div class="text-secondary">AI Status</div>
                <div class="mt-2">
                    <small class="text-secondary">{{ llm_status }}</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content Grid -->
    <div class="row">
        <!-- Recent Conversations -->
        <div class="col-lg-8 mb-4">
            <div class="cyber-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">
                        <i class="bi bi-chat-left-text"></i> Recent Conversations
                    </h4>
                    <a href="{% url 'chat' %}" class="btn btn-sm btn-outline-light">View All</a>
                </div>
                
                {% if conversations %}
                    <div class="list-group list-group-flush">
                        {% for conv in conversations %}
                        <a href="{% url 'chat_with_id' conv.id %}" 
                           class="list-group-item bg-transparent text-white border-bottom border-secondary py-3 hover-highlight">
                            <div class="d-flex justify-content-between align-items-start">
                                <div style="flex: 1;">
                                    <h6 class="mb-1">{{ conv.title }}</h6>
                                    <small class="text-secondary">
                                        <i class="bi bi-chat"></i> {{ conv.get_message_count }} messages â€¢ 
                                        <i class="bi bi-clock"></i> {{ conv.updated_at|timesince }} ago
                                    </small>
                                </div>
                                <div>
                                    <span class="badge privacy-badge">ðŸ”’</span>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-chat-dots" style="font-size: 48px; opacity: 0.3;"></i>
                        <p class="text-secondary mt-3 mb-0">No conversations yet</p>
                        <a href="{% url 'chat' %}" class="btn btn-cyber mt-3">Start Your First Chat</a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="cyber-card p-4 mb-4">
                <h5 class="mb-3">
                    <i class="bi bi-lightning-fill"></i> Quick Actions
                </h5>
                <div class="d-grid gap-2">
                    <a href="{% url 'chat' %}" class="btn btn-cyber">
                        <i class="bi bi-chat-dots"></i> New Conversation
                    </a>
                    <a href="{% url 'settings' %}" class="btn btn-outline-light">
                        <i class="bi bi-gear"></i> Settings
                    </a>
                    <button class="btn btn-outline-light" onclick="showPrivacyInfo()">
                        <i class="bi bi-shield-check"></i> Privacy Info
                    </button>
                </div>
            </div>
            
            <!-- Privacy Status -->
            <div class="cyber-card p-4 mb-4">
                <h5 class="mb-3">
                    <i class="bi bi-shield-lock"></i> Privacy Status
                </h5>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-secondary">Encryption</span>
                        <span class="badge bg-success">
                            {% if profile.enable_encryption %}Enabled{% else %}Disabled{% endif %}
                        </span>
                    </div>
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar bg-success" style="width: 100%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-secondary">Local Mode</span>
                        <span class="badge bg-success">
                            {% if profile.local_only_mode %}Active{% else %}Off{% endif %}
                        </span>
                    </div>
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar bg-success" style="width: 100%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-secondary">Data Collection</span>
                        <span class="badge bg-success">Zero</span>
                    </div>
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar bg-success" style="width: 100%"></div>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <small class="text-success">
                        <i class="bi bi-check-circle-fill"></i> All systems secure
                    </small>
                </div>
            </div>
            
            <!-- System Info -->
            <div class="cyber-card p-4">
                <h5 class="mb-3">
                    <i class="bi bi-cpu"></i> System Info
                </h5>
                <div class="mb-2">
                    <small class="text-secondary">AI Model:</small>
                    <div class="fw-bold">{{ profile.ai_model }}</div>
                </div>
                <div class="mb-2">
                    <small class="text-secondary">Temperature:</small>
                    <div class="fw-bold">{{ profile.temperature }}</div>
                </div>
                <div class="mb-2">
                    <small class="text-secondary">Max Tokens:</small>
                    <div class="fw-bold">{{ profile.max_tokens }}</div>
                </div>
                <div class="mb-2">
                    <small class="text-secondary">Auto-Delete:</small>
                    <div class="fw-bold">{{ profile.auto_delete_days }} days</div>
                </div>
                
                <a href="{% url 'settings' %}" class="btn btn-sm btn-outline-light w-100 mt-3">
                    Configure
                </a>
            </div>
        </div>
    </div>
    
    <!-- Privacy Features Highlight -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="cyber-card p-4">
                <h5 class="mb-3">
                    <i class="bi bi-info-circle"></i> What Makes CypherVault Secure?
                </h5>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-lock-fill" style="font-size: 2rem; color: var(--primary-accent);"></i>
                            <div class="mt-2 fw-bold">End-to-End Encryption</div>
                            <small class="text-secondary">Messages encrypted before storage</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-hdd-network" style="font-size: 2rem; color: var(--primary-accent);"></i>
                            <div class="mt-2 fw-bold">Local Processing</div>
                            <small class="text-secondary">AI runs on your Black Box</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-eye-slash" style="font-size: 2rem; color: var(--primary-accent);"></i>
                            <div class="mt-2 fw-bold">Zero Tracking</div>
                            <small class="text-secondary">No analytics or telemetry</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-code-square" style="font-size: 2rem; color: var(--primary-accent);"></i>
                            <div class="mt-2 fw-bold">Open Source</div>
                            <small class="text-secondary">Fully auditable code</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hover-highlight {
    transition: all 0.2s ease;
}

.hover-highlight:hover {
    background: rgba(0, 212, 255, 0.05) !important;
    border-left: 3px solid var(--primary-accent) !important;
    transform: translateX(5px);
}
</style>

<script>
function showPrivacyInfo() {
    alert(`ðŸ”’ CypherVault Privacy Guarantee:\n\nâœ“ All messages encrypted end-to-end\nâœ“ AI processing happens locally on your device\nâœ“ Zero data collection or tracking\nâœ“ No cloud services or external APIs\nâœ“ Your data never leaves your Black Box\n\nYour privacy is absolute.`);
}
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}