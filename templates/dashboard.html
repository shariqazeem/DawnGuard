<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5" style="background: var(--dawn-cream);">
    <!-- Welcome Header -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="dawn-card">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2 class="mb-2 fw-bold" style="color: var(--dawn-dark);">
                            Welcome back, <span class="glow-text">{{ user.username }}</span>! ðŸ‘‹
                        </h2>
                        <p class="mb-0" style="color: #666;">
                            Your private AI assistant is ready. All data encrypted and local.
                        </p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <a href="{% url 'chat' %}" class="btn btn-dawn btn-lg">
                            <i class="bi bi-chat-dots-fill"></i> New Chat
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Stats Overview - DAWN Cards -->
    <div class="row mb-5 g-4">
        <div class="col-md-3">
            <div class="dawn-card text-center h-100">
                <div class="h2 mb-2 glow-text fw-bold">{{ total_messages }}</div>
                <div class="mb-3" style="color: #666; font-weight: 500;">Total Messages</div>
                <div class="mt-auto">
                    <small class="privacy-badge">
                        <i class="bi bi-shield-check"></i> {{ encrypted_messages }} Encrypted
                    </small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="dawn-card text-center h-100">
                <div class="h2 mb-2 fw-bold" style="color: var(--dawn-purple);">{{ conversations.count }}</div>
                <div class="mb-3" style="color: #666; font-weight: 500;">Active Chats</div>
                <div class="mt-auto">
                    <small class="privacy-badge">
                        <i class="bi bi-lock-fill"></i> Private
                    </small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="dawn-card text-center h-100">
                <div class="h2 mb-2 fw-bold" style="color: var(--dawn-blue);">{{ documents.count }}</div>
                <div class="mb-3" style="color: #666; font-weight: 500;">Documents</div>
                <div class="mt-auto">
                    <small style="background: rgba(74,144,226,0.1); border: 1.5px solid var(--dawn-blue); color: var(--dawn-blue); padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 600;">
                        <i class="bi bi-file-earmark-text"></i> Encrypted
                    </small>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="dawn-card text-center h-100">
                <div class="mb-2">
                    {% if llm_status == 'Online' %}
                        <span class="badge bg-success" style="font-size: 1.2rem; padding: 10px 20px; border-radius: 24px;">ðŸŸ¢ Online</span>
                    {% else %}
                        <span class="badge bg-warning" style="font-size: 1.2rem; padding: 10px 20px; border-radius: 24px;">ðŸŸ¡ Mock</span>
                    {% endif %}
                </div>
                <div class="mb-3" style="color: #666; font-weight: 500;">AI Status</div>
                <div class="mt-auto">
                    <small style="color: #999;">{{ llm_status }}</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content Grid -->
    <div class="row g-4">
        <!-- Recent Conversations -->
        <div class="col-lg-8">
            <div class="dawn-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0 fw-bold" style="color: var(--dawn-dark);">
                        <i class="bi bi-chat-left-text"></i> Recent Conversations
                    </h4>
                    <a href="{% url 'chat' %}" class="btn btn-sm btn-outline-dawn">View All</a>
                </div>
                
                {% if conversations %}
                    <div class="list-group list-group-flush">
                        {% for conv in conversations %}
                        <a href="{% url 'chat_with_id' conv.id %}" 
                           class="list-group-item bg-transparent border-0 py-3 hover-highlight"
                           style="border-left: 3px solid transparent !important; padding-left: 16px; border-radius: 12px; margin-bottom: 4px; color: var(--dawn-dark);">
                            <div class="d-flex justify-content-between align-items-start">
                                <div style="flex: 1;">
                                    <h6 class="mb-1 fw-bold">{{ conv.title }}</h6>
                                    <small style="color: #999;">
                                        <i class="bi bi-chat"></i> {{ conv.get_message_count }} messages â€¢ 
                                        <i class="bi bi-clock"></i> {{ conv.updated_at|timesince }} ago
                                    </small>
                                </div>
                                <div>
                                    <span class="privacy-badge">ðŸ”’</span>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-chat-dots" style="font-size: 48px; opacity: 0.2; color: #999;"></i>
                        <p style="color: #999;" class="mt-3 mb-0">No conversations yet</p>
                        <a href="{% url 'chat' %}" class="btn btn-dawn mt-3">Start Your First Chat</a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="dawn-card mb-4">
                <h5 class="mb-3 fw-bold" style="color: var(--dawn-dark);">
                    <i class="bi bi-lightning-fill"></i> Quick Actions
                </h5>
                <div class="d-grid gap-2">
                    <a href="{% url 'chat' %}" class="btn btn-dawn">
                        <i class="bi bi-chat-dots"></i> New Conversation
                    </a>
                    <a href="{% url 'settings' %}" class="btn btn-outline-dawn">
                        <i class="bi bi-gear"></i> Settings
                    </a>
                    <button class="btn btn-outline-dawn" onclick="showPrivacyInfo()">
                        <i class="bi bi-shield-check"></i> Privacy Info
                    </button>
                </div>
            </div>
            
            <!-- Privacy Status -->
            <div class="dawn-card mb-4">
                <h5 class="mb-3 fw-bold" style="color: var(--dawn-dark);">
                    <i class="bi bi-shield-lock"></i> Privacy Status
                </h5>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span style="color: #666;">Encryption</span>
                        <span class="badge bg-success" style="border-radius: 12px;">
                            {% if profile.enable_encryption %}Enabled{% else %}Disabled{% endif %}
                        </span>
                    </div>
                    <div class="progress" style="height: 6px; border-radius: 12px; background: rgba(76,175,80,0.1);">
                        <div class="progress-bar bg-success" style="width: 100%; border-radius: 12px;"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span style="color: #666;">Local Mode</span>
                        <span class="badge bg-success" style="border-radius: 12px;">
                            {% if profile.local_only_mode %}Active{% else %}Off{% endif %}
                        </span>
                    </div>
                    <div class="progress" style="height: 6px; border-radius: 12px; background: rgba(76,175,80,0.1);">
                        <div class="progress-bar bg-success" style="width: 100%; border-radius: 12px;"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span style="color: #666;">Data Collection</span>
                        <span class="badge bg-success" style="border-radius: 12px;">Zero</span>
                    </div>
                    <div class="progress" style="height: 6px; border-radius: 12px; background: rgba(76,175,80,0.1);">
                        <div class="progress-bar bg-success" style="width: 100%; border-radius: 12px;"></div>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <small class="text-success fw-bold">
                        <i class="bi bi-check-circle-fill"></i> All systems secure
                    </small>
                </div>
            </div>
            
            <!-- System Info -->
            <div class="dawn-card">
                <h5 class="mb-3 fw-bold" style="color: var(--dawn-dark);">
                    <i class="bi bi-cpu"></i> System Info
                </h5>
                <div class="mb-3">
                    <small style="color: #999;">AI Model:</small>
                    <div class="fw-bold" style="color: var(--dawn-dark);">{{ profile.ai_model }}</div>
                </div>
                <div class="mb-3">
                    <small style="color: #999;">Temperature:</small>
                    <div class="fw-bold" style="color: var(--dawn-dark);">{{ profile.temperature }}</div>
                </div>
                <div class="mb-3">
                    <small style="color: #999;">Max Tokens:</small>
                    <div class="fw-bold" style="color: var(--dawn-dark);">{{ profile.max_tokens }}</div>
                </div>
                <div class="mb-3">
                    <small style="color: #999;">Auto-Delete:</small>
                    <div class="fw-bold" style="color: var(--dawn-dark);">{{ profile.auto_delete_days }} days</div>
                </div>
                
                <a href="{% url 'settings' %}" class="btn btn-outline-dawn w-100 mt-3">
                    Configure
                </a>
            </div>
        </div>
    </div>
    
    <!-- Privacy Features Highlight -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="dawn-card" style="background: linear-gradient(135deg, rgba(255,107,53,0.03), rgba(107,53,255,0.03));">
                <h5 class="mb-4 fw-bold text-center" style="color: var(--dawn-dark);">
                    <i class="bi bi-info-circle"></i> What Makes CypherVault Secure?
                </h5>
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="text-center">
                            <i class="bi bi-lock-fill" style="font-size: 2.5rem; color: var(--dawn-orange);"></i>
                            <div class="mt-3 fw-bold" style="color: var(--dawn-dark);">End-to-End Encryption</div>
                            <small style="color: #666;">Messages encrypted before storage</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <i class="bi bi-hdd-network" style="font-size: 2.5rem; color: var(--dawn-purple);"></i>
                            <div class="mt-3 fw-bold" style="color: var(--dawn-dark);">Local Processing</div>
                            <small style="color: #666;">AI runs on your Black Box</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <i class="bi bi-eye-slash" style="font-size: 2.5rem; color: #4CAF50;"></i>
                            <div class="mt-3 fw-bold" style="color: var(--dawn-dark);">Zero Tracking</div>
                            <small style="color: #666;">No analytics or telemetry</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <i class="bi bi-code-square" style="font-size: 2.5rem; color: var(--dawn-blue);"></i>
                            <div class="mt-3 fw-bold" style="color: var(--dawn-dark);">Open Source</div>
                            <small style="color: #666;">Fully auditable code</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hover-highlight {
    transition: all 0.3s ease;
}

.hover-highlight:hover {
    background: rgba(255, 107, 53, 0.05) !important;
    border-left: 3px solid var(--dawn-orange) !important;
    transform: translateX(5px);
}
</style>

<script>
function showPrivacyInfo() {
    alert(`ðŸ”’ CypherVault Privacy Guarantee:\n\nâœ“ All messages encrypted end-to-end\nâœ“ AI processing happens locally on your device\nâœ“ Zero data collection or tracking\nâœ“ No cloud services or external APIs\nâœ“ Your data never leaves your Black Box\n\nYour privacy is absolute.`);
}
</script>
{% endblock %}